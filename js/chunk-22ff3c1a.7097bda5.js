(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-22ff3c1a"],{"0972":function(t){t.exports=JSON.parse("{}")},"6f25":function(t,e,n){"use strict";n("b742")},"759f9":function(t,e,n){"use strict";var i=n("5ca1"),a=n("0a49")(3);i(i.P+i.F*!n("2f21")([].some,!0),"Array",{some:function(t){return a(this,t,arguments[1])}})},b742:function(t,e,n){},df76:function(t,e,n){"use strict";n("f69f")},ede2:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.fragments?n("div",{staticClass:"animate-show"},[t.curIndex>=0?[t.fragments[t.curIndex]?n("fragment",{attrs:{item:t.fragments[t.curIndex]},on:{finished:t.allSectionFinished}}):t._e()]:t._e(),t.isEnd?n("end-page"):t._e()],2):t._e()},a=[],o=n("d225"),r=n("b0b4"),s=n("bd86"),c=(n("6b54"),n("87b3"),n("2397"),n("6d67"),n("4e2b")),l=n("308d"),f=n("6bb5"),u=n("9242");function d(t){var e=h();return function(){var n,i=Object(f["a"])(t);if(e){var a=Object(f["a"])(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Object(l["a"])(this,n)}}function h(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var g=function(t){Object(c["a"])(n,t);var e=d(n);function n(t){return Object(o["a"])(this,n),e.call(this,t)}return n}(u["a"]);function m(t){var e=p();return function(){var n,i=Object(f["a"])(t);if(e){var a=Object(f["a"])(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Object(l["a"])(this,n)}}function p(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}g.type={DEFAULT:1,FOLLOW:2};var v=function(t){Object(c["a"])(n,t);var e=m(n);function n(t){return Object(o["a"])(this,n),e.call(this,t)}return n}(u["a"]);function y(t){var e=D();return function(){var n,i=Object(f["a"])(t);if(e){var a=Object(f["a"])(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Object(l["a"])(this,n)}}function D(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var x=function(t){Object(c["a"])(n,t);var e=y(n);function n(){return Object(o["a"])(this,n),e.apply(this,arguments)}return n}(u["a"]);function b(t){var e=w();return function(){var n,i=Object(f["a"])(t);if(e){var a=Object(f["a"])(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Object(l["a"])(this,n)}}function w(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var O=function(t){Object(c["a"])(n,t);var e=b(n);function n(t){var i;return Object(o["a"])(this,n),i=e.call(this,t),t.coat&&t.coat.data&&(i.coat=new x(t.coat.data)),t.eye&&t.eye.data&&(i.eye=new x(t.eye.data)),t.pant&&t.pant.data&&(i.pant=new x(t.pant.data)),i}return n}(u["a"]),R=n("6275");function j(t){var e=S();return function(){var n,i=Object(f["a"])(t);if(e){var a=Object(f["a"])(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Object(l["a"])(this,n)}}function S(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var A=function(t){Object(c["a"])(n,t);var e=j(n);function n(t){var i;return Object(o["a"])(this,n),i=e.call(this,t),i.isShowDialog=!1,i.isShowModel=!1,t.character_extra&&(i.characterExtra=R["a"].parseJson(t.character_extra)),t.dialog_extra&&(i.dialogExtra=R["a"].parseJson(t.dialog_extra)),t.dialog&&t.dialog.data&&(i.dialog=new g(t.dialog.data)),t.eyeAction&&t.eyeAction.data&&(i.eyeAction=new v(t.eyeAction.data)),t.coatAction&&t.coatAction.data&&(i.coatAction=new v(t.coatAction.data)),t.character&&t.character.data&&(i.character=new O(t.character.data)),i}return n}(u["a"]);function F(t){var e=E();return function(){var n,i=Object(f["a"])(t);if(e){var a=Object(f["a"])(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Object(l["a"])(this,n)}}function E(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var I=function(t){Object(c["a"])(n,t);var e=F(n);function n(t){var i;if(Object(o["a"])(this,n),i=e.call(this,t),t.extra&&(i.extra=R["a"].parseJson(t.extra)),t.sections&&t.sections.data){var a=[];t.sections.data.map((function(t){a.push(new A(t))})),i.sections=a}return i}return n}(u["a"]);function $(t){var e=_();return function(){var n,i=Object(f["a"])(t);if(e){var a=Object(f["a"])(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Object(l["a"])(this,n)}}function _(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var T=function(t){Object(c["a"])(n,t);var e=$(n);function n(t){var i;if(Object(o["a"])(this,n),i=e.call(this,t),t.articles&&t.articles.data){var a=[];t.articles.data.map((function(t){a.push(new I(t))})),i.articles=a}return i}return n}(u["a"]);T.minTime=1300,T.textSpeed=10;var C=n("db49"),M=function(){function t(){Object(o["a"])(this,t)}return Object(r["a"])(t,null,[{key:"show",value:function(t){var e="".concat(this.baseApi,"/scenes/").concat(t),n={include:"articles.sections.dialog,articles.sections.character.eye,articles.sections.character.coat,articles.sections.character.pant"};return T.show(e,n)}}]),t}();Object(s["a"])(M,"baseApi",C["a"].api.animationUrl);var P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fragment"},[n("div",{ref:"fragmentContent",staticClass:"fragment-content"},[t.fragmentData?[t.fragmentData.backgroundImage?n("img",{staticClass:"background-img",attrs:{src:t.fragmentData.backgroundImage,alt:"animate-bg"}}):t._e(),t._l(t.fragmentData.sections,(function(e,i){return[n("div",{key:e.id},[e.isShowDialog?n("dialog-model",{attrs:{item:e},on:{finished:function(n){return t.dialogFinished(e)}}}):t._e()],1)]}))]:t._e(),n("div",{ref:"testModel",staticClass:"test-model"}),n("div",{ref:"testModel1",staticClass:"test-model"})],2)])},N=[],k=(n("759f9"),n("7f7f"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.modelData&&t.isShow?n("svg",{ref:"svg_"+t.modelData.id,style:{transform:"rotateY("+("right"===t.modelData.characterExtra.position?"180deg":0)+")"},attrs:{width:t.svgInfo.width+"px",height:t.svgInfo.height+"px",viewBox:"0 0 "+t.viewBox.width+" "+t.viewBox.height}},[n("g",{domProps:{innerHTML:t._s(t.svgInfo.head)}}),n("g",{domProps:{innerHTML:t._s(t.svgInfo.pant)}}),n("g",{domProps:{innerHTML:t._s(t.svgInfo.coat)}})]):t._e()}),J=[],L=(n("e955"),{name:"DrawSvg",props:{item:Object},data:function(){return{modelData:null,isShow:!1,viewBox:{width:0,height:0},svgInfo:{width:0,height:0,head:null,coat:null,pant:null}}},watch:{item:{deep:!0,handler:function(){this.parseData()}}},mounted:function(){this.parseData()},methods:{parseData:function(){if(this.modelData=JSON.parse(JSON.stringify(this.item)),this.modelData&&!this.modelData.character)return this.isShow=!1,this.sendFinished(),!1;this.setSVGInfo()},setSVGInfo:function(){var t=this,e=this.modelData.characterExtra,n=e.characterWidth,i=e.characterHeight,a=e.svgWidth,o=e.svgHeight,r=R["a"].getMobileRatio(),s=r.widthRatio,c=r.heightRatio;this.viewBox.width=a,this.viewBox.height=o,this.svgInfo.width=n*s,this.svgInfo.height=i*c,this.svgInfo.head=this.modelData.character.eye.svg,this.svgInfo.coat=this.modelData.character.coat.svg,this.svgInfo.pant=this.modelData.character.pant.svg,this.isShow=!0,this.$nextTick((function(){return t.setSVGPosition()})),this.sendFinished()},setSVGPosition:function(){var t=this.modelData,e=t.id,n=t.characterExtra,i=void 0===n?{}:n,a=i.x,o=i.y,r=R["a"].getMobileRatio(),s=r.widthRatio,c=r.heightRatio;this.$refs["svg_".concat(e)].style.position="absolute",this.$refs["svg_".concat(e)].style.left="".concat(a*s,"px"),this.$refs["svg_".concat(e)].style.top="".concat(o*c,"px")},sendFinished:function(){this.$emit("finished")}}}),B=L,H=n("2877"),G=Object(H["a"])(B,k,J,!1,null,null,null),V=G.exports,z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dialog-model"},[n("transition",{attrs:{"enter-active-class":t.enterActiveClass}},[t.dialogInfo?n("follow-dialog",{attrs:{item:t.dialogInfo},on:{finished:t.FollowDialogFinished}}):t._e()],1)],1)},W=[],U=(n("a481"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"followDialog",staticClass:"follow-dialog"},[t.dialogData&&!t.loading?n("div",{staticClass:"dialog-content",domProps:{innerHTML:t._s(t.dialogData.dialogExtra.content)}}):t._e()])}),X=[],Y={name:"FollowDialog",props:{item:Object},data:function(){return{dialogData:null,loading:!1}},mounted:function(){var t=this;this.loading=!0,this.dialogData=JSON.parse(JSON.stringify(this.item)),this.dialogData.dialog.extra=R["a"].parseJson(this.dialogData.dialog.extra),this.$nextTick((function(){t.setDialogInfo()}))},methods:{setDialogInfo:function(){var t=this.dialogData,e=t.dialog,n=t.dialogExtra,i=n.x,a=n.y,o=n.fontColor,r=void 0===o?"#000":o,s=n.fontSize,c=void 0===s?"16":s,l=e.backgroundImage,f=e.extra,u=f.padding,d=void 0===u?{}:u,h=R["a"].getMobileRatio(),g=h.widthRatio,m=h.heightRatio;this.$refs["followDialog"].style.color=r,this.$refs["followDialog"].style.fontSize=c*g+"px",this.$refs["followDialog"].style.paddingLeft=d.left*g+"px",this.$refs["followDialog"].style.paddingRight=d.right*g+"px",this.$refs["followDialog"].style.paddingTop=d.top*g+"px",this.$refs["followDialog"].style.paddingBottom=d.bottom*g+"px",this.$refs["followDialog"].style.position="fixed",this.$refs["followDialog"].style.left=i*g+"px",this.$refs["followDialog"].style.top=a*m+"px",this.createImg(this.$refs["followDialog"],l)},createImg:function(t,e){var n=this,i=document.createElement("img");i.src=e,i.style.width="100%",i.style.position="absolute",i.style.left="50%",i.style.top="50%",i.style.transform="translate(-50%,-50%)",i.style.zIndex="-1",i.style.objectFit="cover",t.appendChild(i),this.loading=!1;var a=this.dialogData.dialogExtra,o=void 0===a?{}:a,r=o.animationDuration,s=void 0===r?0:r,c=this.item.finishTime+1e3*s;setTimeout((function(){return n.$emit("finished")}),c)}}},q=Y,K=(n("6f25"),Object(H["a"])(q,U,X,!1,null,"6ab37bfd",null)),Q=K.exports,Z={name:"DialogModel",components:{FollowDialog:Q},props:{item:{type:Object,default:null}},data:function(){return{dialogInfo:null,enterActiveClass:"animate__animated"}},watch:{item:{deep:!0,handler:function(){this.init()}}},mounted:function(){this.init()},methods:{init:function(){this.dialogInfo={dialog:this.item.dialog,dialogExtra:this.item.dialogExtra,finishTime:this.getFinishedTime()},this.dialogInfo.dialogExtra&&this.dialogInfo.dialogExtra.animation&&(this.enterActiveClass+=" "+this.dialogInfo.dialogExtra.animation)},FollowDialogFinished:function(){this.$emit("finished")},getFinishedTime:function(){var t=0,e=/<[^>]+>/g;if(this.item.dialogExtra.content){var n=this.item.dialogExtra.content.replace(e,"").length;t<n&&(t=n)}var i=t/T.textSpeed;return i<1&&(i=1),T.minTime*i}}},tt=Z,et=Object(H["a"])(tt,z,W,!1,null,null,null),nt=et.exports,it=n("1310"),at=n("1cd4"),ot={name:"Fragment",components:{DialogModel:nt,DrawSvg:V},props:{item:{type:Object,default:null}},data:function(){return{fragmentData:null,isEnd:!1,sectionFinishedCount:0,sectionNum:0,loadModelFinished:!1,modelCount:0,modelNum:0,loadDialogFinished:!1,dialogNum:0,dialogCount:0,controlStartType:null,controlEndType:null}},watch:{item:{deep:!0,handler:function(){var t=this;this.resetData().then((function(){t.init()}))}},isEnd:function(t){t&&this.$emit("finished")},loadModelFinished:function(t){t&&("model"===this.controlStartType&&this.playStartAnimation(),"model"===this.controlEndType&&this.playEndAnimation())},loadDialogFinished:function(t){t&&("dialog"===this.controlStartType&&this.playStartAnimation(),"dialog"===this.controlEndType&&this.playEndAnimation())}},mounted:function(){var t=this;this.init(),this.$nextTick((function(){t.loadFirst(),t.loadSecond()}))},methods:{loadFirst:function(){var t=this,e=new at["a"];e.load(this.$refs["testModel"],(function(){e.changeAction("run",!0),t.$refs["testModel"].style.transition="all 3s linear",t.$refs["testModel"].style.transform="translateX(400px)",setTimeout((function(){e.changeSkin("3"),e.changeAction("jump",!1)}),3e3),setTimeout((function(){e.changeAction("idle",!0)}),4e3)}))},loadSecond:function(){var t=this,e=new at["a"];e.load(this.$refs["testModel1"],(function(){e.changeAction("walk",!0),t.$refs["testModel1"].style.transition="all 2s linear",t.$refs["testModel1"].style.transform="translateX(400px)",setTimeout((function(){e.changeSkin("3"),e.changeAction("jump",!1)}),2e3),setTimeout((function(){e.changeAction("idle",!0)}),3e3)}))},init:function(){var t=this;if(this.fragmentData=JSON.parse(JSON.stringify(this.item)),!this.fragmentData)return!1;var e=this.fragmentData,n=e.extra,i=void 0===n?{}:n,a=e.sections,o=void 0===a?[]:a,r=i.startAnimation;r&&this.loadResource(),this.sectionNum=o.length,o.map((function(e){e.character&&t.modelNum++,e.dialog&&t.dialogNum++}))},playStartAnimation:function(){var t=this,e=this.fragmentData.extra.startAnimation,n=void 0===e?{}:e,i=n.name,a=n.config,o=void 0===a?{}:a;i?this.$nextTick((function(){t.playAnimate(i,o,t.$refs["fragmentContent"],t.startAnimateFinished)})):this.startAnimateFinished()},playEndAnimation:function(){var t=this,e=this.fragmentData.extra.endAnimation,n=void 0===e?{}:e,i=n.name,a=n.config,o=void 0===a?{}:a;i?this.$nextTick((function(){t.playAnimate(i,o,t.$refs["fragmentContent"],t.endAnimateFinished)})):this.endAnimateFinished()},playAnimate:function(t,e,n,i){e.element=n,e.callback=i,it["a"].playAnimate(t,e)},startAnimateFinished:function(){var t=this,e=this.fragmentData.extra.action,n=void 0===e?[]:e;if(n.length>0){n.map((function(e){t.showResource(e),t.controlEndType=e}));var i=n.some((function(t){return"dialog"===t}));i&&(this.controlEndType="dialog")}else this.playEndAnimation()},endAnimateFinished:function(){this.isEnd=!0},loadResource:function(){var t=this,e=this.fragmentData.extra.resources,n=void 0===e?[]:e;n.map((function(e){t.showResource(e),t.controlStartType=e}));var i=n.some((function(t){return"dialog"===t}));i&&(this.controlEndType="dialog")},showResource:function(t){if("model"!==t&&"dialog"!==t)return!1;this.fragmentData.sections.map((function(e,n){"model"===t?e.isShowModel=!0:"dialog"===t&&(e.isShowDialog=!0)}))},modelLoadFinished:function(){this.modelCount++,this.modelCount===this.modelNum&&(this.loadModelFinished=!0)},dialogFinished:function(){this.dialogCount++,this.dialogCount===this.dialogNum&&(this.loadDialogFinished=!0)},resetData:function(){var t=this;return new Promise((function(e){t.fragmentData=null,t.isEnd=!1,t.sectionFinishedCount=0,t.sectionNum=0,t.loadModelFinished=!1,t.modelCount=0,t.modelNum=0,t.loadDialogFinished=!1,t.dialogNum=0,t.dialogCount=0,t.controlStartType=null,t.controlEndType=null,e()}))}}},rt=ot,st=(n("df76"),Object(H["a"])(rt,P,N,!1,null,"0fc55110",null)),ct=st.exports,lt=n("5a0c"),ft=n("6a62"),ut=(n("0972"),{name:"AnimateShow",components:{EndPage:ft["a"],PreloadResource:lt["a"],Fragment:ct},data:function(){return{showPreload:!0,fragments:null,curIndex:0,isEnd:!1}},computed:{fragmentNum:function(){return this.fragments.length}},mounted:function(){this.getItem()},methods:{getItem:function(){var t=this,e=this.$route.params.id;M.show(e).then((function(e){t.fragments=e.articles,t.loading=!0,console.log(t.fragments)}))},startPlay:function(){this.curIndex=0},stopPlay:function(){console.log("这一集播放完成")},allSectionFinished:function(){console.log("第".concat(this.curIndex,"个片段播放完成")),this.fragmentNum<=this.curIndex+1?this.stopPlay():this.curIndex++},preloadFinished:function(){this.showPreload=!1,this.startPlay()}}}),dt=ut,ht=Object(H["a"])(dt,i,a,!1,null,null,null);e["default"]=ht.exports},f69f:function(t,e,n){}}]);